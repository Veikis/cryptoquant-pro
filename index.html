<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CryptoQuant Pro Trader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        body { background: #0a0a0a; color: #e5e5e5; padding-top: env(safe-area-inset-top); overscroll-behavior: none; }
        .glass { background: rgba(28, 28, 30, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .gradient-text { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .signal-sell { background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); }
        .metric-card { background: linear-gradient(145deg, #1c1c1e 0%, #2c2c2e 100%); border: 1px solid rgba(255, 255, 255, 0.05); }
        .level-support { border-left: 3px solid #10b981; }
        .level-resistance { border-left: 3px solid #ef4444; }
        .level-pivot { border-left: 3px solid #3b82f6; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .price-up { color: #10b981; }
        .price-down { color: #ef4444; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-pulse-custom { animation: pulse 1s infinite; }
    </style>
</head>
<body class="min-h-screen bg-black">
    <header class="fixed top-0 left-0 right-0 z-50 glass border-b border-gray-800 safe-top">
        <div class="flex justify-between items-center px-4 py-3">
            <div>
                <h1 class="text-lg font-bold gradient-text">CryptoQuant Pro</h1>
                <p class="text-[10px] text-gray-500 mono"><span id="conn-status" class="status-dot bg-yellow-500 animate-pulse-custom"></span> <span id="status-text">CONECTANDO</span></p>
            </div>
            <div class="flex items-center space-x-2">
                <div class="text-right mr-2">
                    <div class="text-xs text-gray-400">BTC/USDT</div>
                    <div class="text-lg font-bold mono" id="btc-price">$0.00</div>
                </div>
                <div id="change-box" class="w-12 h-10 rounded-lg flex items-center justify-center bg-gray-800">
                    <span id="price-change" class="font-bold text-[10px]">0%</span>
                </div>
            </div>
        </div>
    </header>

    <main class="pt-24 pb-24 px-4 max-w-lg mx-auto">
        <div class="mb-6 p-4 rounded-2xl signal-sell text-white shadow-lg shadow-red-500/20">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <div class="text-xs opacity-80 mb-1 uppercase">Sinal Baseado em Fluxo</div>
                    <div class="text-2xl font-bold">AGUARDAR FUNDO</div>
                </div>
                <div class="text-right"><div class="text-3xl font-bold mono">C</div><div class="text-xs opacity-80">Capitulação</div></div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="metric-card p-3 rounded-xl text-center">
                <div class="text-xs text-gray-500 mb-1">RSI (14)</div>
                <div id="rsi" class="text-lg font-bold mono">0.00</div>
            </div>
            <div class="metric-card p-3 rounded-xl text-center">
                <div class="text-xs text-gray-500 mb-1">Funding Rate</div>
                <div id="funding" class="text-lg font-bold mono">0.0000</div>
            </div>
        </div>

        <div class="mb-6">
            <h3 class="text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wider">Níveis Críticos (Auto-Pivot)</h3>
            <div class="space-y-2">
                <div class="metric-card p-3 rounded-xl level-resistance flex justify-between items-center">
                    <div>
                        <div class="text-[10px] text-red-400">RESISTÊNCIA 24H</div>
                        <div id="high-24h" class="text-md font-bold mono">$0.00</div>
                    </div>
                </div>
                <div class="metric-card p-3 rounded-xl level-pivot flex justify-between items-center border-blue-500/50">
                    <div>
                        <div class="text-[10px] text-blue-400">PREÇO ATUAL</div>
                        <div id="pivot-price" class="text-md font-bold mono">$0.00</div>
                    </div>
                    <div class="text-right"><div class="text-[10px] text-gray-400">Status</div><div class="text-xs text-yellow-400">Pivotando</div></div>
                </div>
                <div class="metric-card p-3 rounded-xl level-support flex justify-between items-center">
                    <div>
                        <div class="text-[10px] text-green-400">SUPORTE 24H</div>
                        <div id="low-24h" class="text-md font-bold mono">$0.00</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-6">
            <h3 class="text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wider">Order Book L2</h3>
            <div class="glass rounded-xl p-3 mono text-[11px]">
                <div id="asks" class="text-red-400 space-y-1 mb-2"></div>
                <div id="book-price" class="py-2 text-center border-y border-gray-800 font-bold text-sm text-white">0.00</div>
                <div id="bids" class="text-green-400 space-y-1 mt-2"></div>
            </div>
        </div>

        <div class="metric-card rounded-2xl p-4 border border-blue-500/20">
            <h3 class="text-xs font-semibold text-blue-400 mb-3 uppercase">Análise de Imagens</h3>
            <div class="grid grid-cols-2 gap-2 mb-4">
                <div class="h-20 border-2 border-dashed border-gray-700 rounded-xl flex items-center justify-center text-xs text-gray-500" onclick="document.getElementById('f1').click()">
                    <input type="file" id="f1" class="hidden" onchange="preview(this, 'p1')">
                    <span id="p1">Gráfico</span>
                </div>
                <div class="h-20 border-2 border-dashed border-gray-700 rounded-xl flex items-center justify-center text-xs text-gray-500" onclick="document.getElementById('f2').click()">
                    <input type="file" id="f2" class="hidden" onchange="preview(this, 'p2')">
                    <span id="p2">On-Chain</span>
                </div>
            </div>
            <button class="w-full bg-blue-600 py-3 rounded-xl font-bold text-sm">ANALISAR CONFLUÊNCIA</button>
        </div>
    </main>

    <div class="fixed bottom-0 left-0 right-0 glass border-t border-gray-800 safe-bottom p-4">
        <div class="flex space-x-3 max-w-lg mx-auto">
            <button class="flex-1 py-3 text-sm font-semibold bg-green-600 rounded-xl">COMPRAR</button>
            <button class="flex-1 py-3 text-sm font-semibold bg-red-600 rounded-xl">VENDER</button>
        </div>
    </div>

    <script>
        const WS_URL = window.location.origin.replace(/^http/, 'ws');
        let ws = null;

        function connect() {
            ws = new WebSocket(WS_URL);
            ws.onopen = () => {
                document.getElementById('conn-status').className = 'status-dot bg-green-500 animate-pulse-custom';
                document.getElementById('status-text').innerText = 'LIVE';
            };
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                updateDashboard(data);
            };
            ws.onclose = () => {
                document.getElementById('conn-status').className = 'status-dot bg-red-500';
                document.getElementById('status-text').innerText = 'OFFLINE';
                setTimeout(connect, 3000);
            };
        }

        function updateDashboard(data) {
            const priceStr = data.price.toLocaleString('en-US', { minimumFractionDigits: 2 });
            document.getElementById('btc-price').innerText = '$' + priceStr;
            document.getElementById('pivot-price').innerText = '$' + priceStr;
            document.getElementById('book-price').innerText = priceStr;
            
            // RSI e Funding
            document.getElementById('rsi').innerText = data.rsi.toFixed(2);
            document.getElementById('rsi').className = data.rsi < 30 ? 'text-green-400 font-bold' : (data.rsi > 70 ? 'text-red-400 font-bold' : 'text-white');
            document.getElementById('funding').innerText = data.funding.toFixed(4);

            // High/Low
            document.getElementById('high-24h').innerText = '$' + data.high24h.toLocaleString();
            document.getElementById('low-24h').innerText = '$' + data.low24h.toLocaleString();

            // Variação 24h
            const changeEl = document.getElementById('price-change');
            changeEl.innerText = (data.change24h > 0 ? '+' : '') + data.change24h.toFixed(2) + '%';
            document.getElementById('change-box').className = data.change24h >= 0 ? 'w-12 h-10 rounded-lg flex items-center justify-center bg-green-500/20 text-green-400' : 'w-12 h-10 rounded-lg flex items-center justify-center bg-red-500/20 text-red-400';

            // Order Book Real
            updateBook('asks', data.orderBook.asks);
            updateBook('bids', data.orderBook.bids);
        }

        function updateBook(id, orders) {
            let html = '';
            orders.slice(0, 4).forEach(o => {
                html += `<div class="flex justify-between"><span>${parseFloat(o[0]).toFixed(1)}</span><span class="opacity-50">${parseFloat(o[1]).toFixed(3)}</span></div>`;
            });
            document.getElementById(id).innerHTML = html;
        }

        function preview(input, id) {
            if (input.files && input.files[0]) {
                document.getElementById(id).innerText = "Anexo: " + input.files[0].name.substring(0, 10) + "...";
                document.getElementById(id).classList.add('text-blue-400');
            }
        }

        connect();
    </script>
</body>
</html>
