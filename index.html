<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CQ Ultra - Análise de Ciclos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #020202; --card: #0d0d0f; --blue: #3b82f6; --green: #10b981; --red: #ef4444; --gold: #f59e0b; }
        * { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        body { background: var(--bg); color: #f1f1f1; padding-bottom: 60px; }
        .card-pro { background: var(--card); border: 1px solid rgba(255,255,255,0.04); border-radius: 24px; padding: 20px; margin-bottom: 16px; }
        .tab-btn { font-size: 10px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.1em; color: #555; padding: 12px 6px; border-bottom: 2px solid transparent; transition: 0.3s; }
        .tab-btn.active { color: var(--blue); border-color: var(--blue); }
        .metric-bar { background: #1a1a1c; height: 6px; border-radius: 10px; overflow: hidden; margin-top: 6px; }
        .metric-fill { height: 100%; transition: width 1s ease-in-out; }
        select { background: #1a1a1c; border: 1px solid #333; color: white; padding: 8px; border-radius: 12px; font-size: 12px; font-weight: bold; width: 100%; outline: none; }
    </style>
</head>
<body>

    <header class="fixed top-0 left-0 right-0 z-50 bg-black/90 backdrop-blur-xl px-6 py-5 flex justify-between items-center border-b border-white/5">
        <h1 class="text-white font-black text-xl italic uppercase tracking-tighter">CQ <span class="text-blue-500">Ultra</span></h1>
        <div id="price" class="text-xl font-black mono text-white leading-none tracking-tighter">$0.00</div>
    </header>

    <main class="pt-24 px-4 max-w-xl mx-auto">

        <nav class="flex space-x-6 mb-6 overflow-x-auto no-scrollbar">
            <button onclick="switchTab('terminal')" id="btn-terminal" class="tab-btn active">Terminal</button>
            <button onclick="switchTab('hist')" id="btn-hist" class="tab-btn">Memória de Ciclo</button>
        </nav>

        <section id="tab-terminal" class="tab-content">
            <div class="card-pro border-blue-500/20">
                <h3 class="text-[10px] font-black text-blue-400 uppercase mb-4">Sincronização Ativa</h3>
                
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="h-32 border-2 border-dashed border-gray-800 rounded-3xl flex items-center justify-center bg-black relative overflow-hidden" onclick="document.getElementById('f1').click()">
                        <input type="file" id="f1" class="hidden" onchange="handleFileChange(this, 'p1', 'chart')">
                        <img id="p1" class="hidden absolute inset-0 w-full h-full object-cover">
                        <span class="text-[9px] font-black text-gray-600">GRAFÍCOS</span>
                    </div>
                    <div class="h-32 border-2 border-dashed border-gray-800 rounded-3xl flex items-center justify-center bg-black relative overflow-hidden" onclick="document.getElementById('f2').click()">
                        <input type="file" id="f2" class="hidden" onchange="handleFileChange(this, 'p2', 'onchain')">
                        <img id="p2" class="hidden absolute inset-0 w-full h-full object-cover">
                        <span class="text-[9px] font-black text-gray-600">ON-CHAIN</span>
                    </div>
                </div>

                <div class="space-y-4 mb-4">
                    <div>
                        <div class="flex justify-between text-[9px] font-bold uppercase"><span>SOPR (Sentimento)</span><span id="v-sopr">0.00</span></div>
                        <div class="metric-bar"><div id="b-sopr" class="metric-fill bg-red-500" style="width: 0%"></div></div>
                    </div>
                    <div>
                        <div class="flex justify-between text-[9px] font-bold uppercase"><span>Netflow (Pressão)</span><span id="v-net">0.00</span></div>
                        <div class="metric-bar"><div id="b-net" class="metric-fill bg-orange-500" style="width: 0%"></div></div>
                    </div>
                </div>
                
                <button onclick="processar()" class="w-full bg-blue-600 py-4 rounded-2xl text-[11px] font-black uppercase tracking-widest">Analisar Variação</button>
            </div>
            
            <div id="res-box" class="hidden card-pro border-white/5">
                <div id="res-body" class="text-[11px] text-gray-400 leading-relaxed"></div>
            </div>
        </section>

        <section id="tab-hist" class="tab-content hidden">
            <div class="card-pro">
                <h3 class="text-[10px] font-black text-gray-500 uppercase mb-4">Comparação Histórica</h3>
                <label class="text-[9px] font-bold text-gray-600 uppercase mb-2 block">Selecione o Ano para Comparar:</label>
                <select id="cycle-select" onchange="updateCycleInfo()">
                    <option value="2015">2015 - O Despertar (Acumulação Lenta)</option>
                    <option value="2018">2018 - A Grande Capitulação (Inverno)</option>
                    <option value="2020">2020 - O Cisne Negro (V-Shape)</option>
                    <option value="2024" selected>2024 - O Ciclo Institucional (ETF)</option>
                </select>

                <div id="cycle-display" class="mt-6 space-y-4">
                    </div>
            </div>
        </section>

    </main>

    <script>
        const cycleData = {
            "2015": { desc: "Fundo de $160. Caracterizado por 300 dias de lateralização lateral profunda.", sopr: "0.98", risk: "Baixo", color: "green" },
            "2018": { desc: "Capitulação de $6k para $3k. Exaustão total de mineradores.", sopr: "0.95", risk: "Extremo", color: "red" },
            "2020": { desc: "Recuperação explosiva pós-pandemia. Instituições começam a entrar.", sopr: "1.02", risk: "Moderado", color: "blue" },
            "2024": { desc: "Ciclo atual. Suporte em $65k é a linha na areia para os ETFs.", sopr: "0.99", risk: "Médio", color: "yellow" }
        };

        function updateCycleInfo() {
            const year = document.getElementById('cycle-select').value;
            const data = cycleData[year];
            const display = document.getElementById('cycle-display');
            display.innerHTML = `
                <div class="p-4 bg-white/5 rounded-xl border-l-4 border-${data.color}-500">
                    <h4 class="text-xs font-black uppercase text-white">${year} - Contexto</h4>
                    <p class="text-[11px] text-gray-400 mt-2">${data.desc}</p>
                    <div class="mt-3 flex justify-between text-[9px] font-bold uppercase">
                        <span>SOPR Médio: ${data.sopr}</span>
                        <span>Risco: ${data.risk}</span>
                    </div>
                </div>
            `;
        }

        let hashes = { chart: null, onchain: null };

        function handleFileChange(input, imgId, type) {
            if (input.files && input.files[0]) {
                const f = input.files[0];
                hashes[type] = `${f.name}-${f.size}`;
                const r = new FileReader();
                r.onload = (e) => {
                    document.getElementById(imgId).src = e.target.result;
                    document.getElementById(imgId).classList.remove('hidden');
                    // Simular leitura das barras ao subir foto
                    if(type === 'onchain') {
                        animateBars();
                    }
                };
                r.readAsDataURL(f);
            }
        }

        function animateBars() {
            document.getElementById('b-sopr').style.width = '92%';
            document.getElementById('v-sopr').innerText = '0.9965 (Capitulação)';
            document.getElementById('b-net').style.width = '45%';
            document.getElementById('v-net').innerText = '+5.5k (Moderado)';
        }

        function processar() {
            const box = document.getElementById('res-box');
            box.classList.remove('hidden');
            const mem = JSON.parse(localStorage.getItem('cq_v8')) || {};
            
            if (hashes.chart === mem.chart && hashes.onchain === mem.onchain) {
                document.getElementById('res-body').innerHTML = "<b class='text-gray-500'>SISTEMA:</b> Nenhuma variação real detectada. As métricas permanecem em modo de espera.";
            } else {
                document.getElementById('res-body').innerHTML = "<b class='text-blue-500'>ALERTA:</b> Nova variação detectada. O mercado está confirmando a zona de exaustão vista em ciclos anteriores.";
                localStorage.setItem('cq_v8', JSON.stringify(hashes));
            }
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            document.getElementById('btn-' + id).classList.add('active');
        }

        updateCycleInfo();
        // Conexão do preço (simplificada para o exemplo)
        setInterval(() => {
            const p = 69000 + Math.random() * 500;
            document.getElementById('price').innerText = '$' + p.toLocaleString('en-US', {maximumFractionDigits:2});
        }, 3000);
    </script>
</body>
</html>
